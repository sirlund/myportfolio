---
interface Props {
  title: string;
  subtitle: string;
  cta: string;
}

const { title, subtitle, cta } = Astro.props;
---

<section id="home" class="hero-section">
  <!-- Three.js Canvas Container -->
  <div id="bubble-container" class="canvas-container"></div>

  <!-- Content -->
  <div class="content-wrapper">
    <div class="content-center">
      <div class="content">
        <div class="animate-fade-up" style="--delay: 0.2s">
          <h1 class="title">{title}</h1>
        </div>

        <div class="animate-fade-up" style="--delay: 0.4s">
          <p class="description">{subtitle}</p>
        </div>

        <div class="animate-fade-up" style="--delay: 0.6s">
          <a href="#work" class="cta-link">
            {cta}
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M7 17L17 7M17 7H7M17 7V17"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Scroll Indicator -->
  <div class="scroll-indicator animate-fade-in" style="--delay: 1.2s">
    <div class="scroll-mouse">
      <svg width="20" height="32" viewBox="0 0 20 32" fill="none">
        <rect x="1" y="1" width="18" height="26" rx="9" stroke="currentColor" stroke-width="1.5" fill="none"/>
        <rect class="scroll-wheel" x="8.5" y="6" width="3" height="6" rx="1.5" fill="currentColor"/>
      </svg>
    </div>
  </div>
</section>

<script>
  import { initBubble } from '@/scripts/three-bubble';

  let cleanup: (() => void) | null = null;

  function init() {
    // Cleanup previous instance if exists
    if (cleanup) {
      cleanup();
      cleanup = null;
    }

    const container = document.getElementById('bubble-container');
    if (container) {
      // Clear container
      container.innerHTML = '';
      cleanup = initBubble(container);
    }
  }

  // Initialize on page load
  init();

  // Re-initialize on View Transitions navigation
  document.addEventListener('astro:page-load', init);

  // Cleanup on page swap (View Transitions)
  document.addEventListener('astro:before-swap', () => {
    if (cleanup) {
      cleanup();
      cleanup = null;
    }
  });
</script>

<style>
  /* ============================================
     Hero Section
     ============================================ */
  .hero-section {
    min-height: 100vh;
    position: relative;
    overflow: hidden;
  }

  /* ============================================
     Canvas Container
     ============================================ */
  .canvas-container {
    position: absolute;
    inset: 0;
    z-index: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fafafa;
    pointer-events: none;
  }

  .canvas-container :global(canvas) {
    display: block;
  }

  /* ============================================
     Content Wrapper
     ============================================ */
  .content-wrapper {
    position: relative;
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: var(--space-4);
    pointer-events: none;
  }

  @media (width >= 40rem) {
    .content-wrapper {
      padding: var(--space-6);
    }
  }

  @media (width >= 48rem) {
    .content-wrapper {
      padding: var(--space-8);
    }
  }

  @media (width >= 64rem) {
    .content-wrapper {
      padding: var(--space-12);
    }
  }

  .content-center {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-width: var(--container-4xl, 56rem);
  }

  .content {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-4);
    text-align: center;
  }

  @media (width >= 40rem) {
    .content {
      gap: var(--space-6);
      padding: var(--space-6);
    }
  }

  @media (width >= 48rem) {
    .content {
      gap: var(--space-8);
      padding: var(--space-8);
    }
  }

  /* ============================================
     Typography
     ============================================ */
  .title {
    font-size: var(--font-display);
    font-weight: var(--font-weight-bold);
    line-height: 1.1;
    margin-bottom: var(--space-2);
  }

  @media (width >= 40rem) {
    .title {
      margin-bottom: var(--space-3);
    }
  }

  @media (width >= 64rem) {
    .title {
      margin-bottom: var(--space-4);
    }
  }

  .description {
    font-size: var(--font-lg);
    color: var(--color-text-secondary);
    max-width: var(--container-2xl, 42rem);
    margin: 0 auto var(--space-4);
    padding: 0 var(--space-2);
    line-height: 1.6;
  }

  @media (width >= 40rem) {
    .description {
      margin-bottom: var(--space-6);
      padding: 0;
    }
  }

  @media (width >= 64rem) {
    .description {
      margin-bottom: var(--space-8);
    }
  }

  /* ============================================
     CTA Link
     ============================================ */
  .cta-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-body);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-primary);
    text-decoration: none;
    padding: var(--space-2) 0;
    border-bottom: 1px solid currentColor;
    transition: all var(--duration-fast) ease;
    pointer-events: auto;
  }

  .cta-link:hover {
    color: var(--color-interactive-primary);
    gap: var(--space-3);
  }

  .cta-link svg {
    transition: transform var(--duration-fast) ease;
  }

  .cta-link:hover svg {
    transform: translate(2px, -2px);
  }

  /* ============================================
     Scroll Indicator
     ============================================ */
  .scroll-indicator {
    position: absolute;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
  }

  @media (width >= 40rem) {
    .scroll-indicator {
      bottom: var(--space-8);
    }
  }

  .scroll-mouse {
    color: var(--color-text-secondary);
    animation: bounce 2s infinite ease-in-out;
  }

  .scroll-wheel {
    animation: pulse 2s infinite ease-in-out;
  }

  /* ============================================
     Animations
     ============================================ */
  @keyframes bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(4px);
    }
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 0.4;
    }
    50% {
      opacity: 1;
    }
  }

  .animate-fade-up {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeUp 0.8s ease forwards;
    animation-delay: var(--delay, 0s);
  }

  .animate-fade-in {
    opacity: 0;
    animation: fadeIn 1s ease forwards;
    animation-delay: var(--delay, 0s);
  }

  @keyframes fadeUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }
</style>
