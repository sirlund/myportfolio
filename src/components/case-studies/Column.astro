---
/**
 * Column component for use inside ContentImageLayout with columnLayout mode.
 *
 * Smart Proportions Logic:
 * When columns share the same height, the ratio of their widths should be equal
 * to the ratio of their natural aspect ratios.
 *
 * Formula: width / height = horizontal_weight_per_unit_of_height
 *
 * Example: If you have two images:
 * - Image 1: 773x1149 → 773/1149 = 0.6727fr
 * - Image 2: 579x1133 → 579/1133 = 0.5111fr
 * Pass columnWidths="0.6727fr 0.5111fr" to parent ContentImageLayout
 */
interface Props {
  /** Natural width of the column content (used for auto-proportions in parent) */
  naturalWidth?: number;
  /** Natural height of the column content (used for auto-proportions in parent) */
  naturalHeight?: number;
  /** Gap between items in column */
  gap?: 'default' | 'none' | 'compact';
  /** Stretch children to fill column height (default: true) */
  stretch?: boolean;
  /** Custom row heights for the column (e.g., "457fr 676fr"). Uses grid layout instead of flex. */
  rowHeights?: string;
  class?: string;
}

const {
  gap = 'default',
  stretch = true,
  rowHeights,
  class: className = ''
} = Astro.props;

// If rowHeights provided, use grid layout
const styleString = rowHeights
  ? `display: grid; grid-template-rows: ${rowHeights}`
  : '';
---

<div
  class:list={[
    'column',
    `gap-${gap}`,
    stretch ? 'column-stretch' : 'column-no-stretch',
    className
  ]}
  style={styleString}
>
  <slot />
</div>

<style>
  .column {
    display: flex;
    flex-direction: column;
    width: 100%;
  }

  .column-stretch {
    align-items: stretch;
  }

  .column-stretch > :global(*) {
    flex: 1;
  }

  .column-no-stretch {
    align-items: start;
  }

  /* Gap variants */
  .gap-default {
    gap: var(--space-6);
  }

  @media (width >= 64rem) {
    .gap-default {
      gap: var(--space-8);
    }
  }

  .gap-compact {
    gap: var(--space-3);
  }

  @media (width >= 64rem) {
    .gap-compact {
      gap: var(--space-4);
    }
  }

  .gap-none {
    gap: 0;
  }
</style>
