---
interface Props {
  src?: string;
  alt: string;
  aspectRatio?: string;
  objectFit?: 'cover' | 'contain' | 'fill' | 'none' | 'scale-down';
  label?: string;
  caption?: string;
  /** Remove default margin from figure element (default: false) */
  noMargin?: boolean;
  class?: string;
  style?: string;
}

const {
  src,
  alt,
  aspectRatio = '16/9',
  objectFit = 'cover',
  label,
  caption,
  noMargin = false,
  class: className = '',
  style: customStyle = ''
} = Astro.props;

const isPlaceholder = !src;

const containerStyle = [
  `aspect-ratio: ${aspectRatio}`,
  customStyle
].filter(Boolean).join('; ');

const imgStyle = `object-fit: ${objectFit}`;
---

<figure class:list={['image-wrapper', { 'no-margin': noMargin }, className]}>
  <div class="image-container" style={containerStyle}>
    {isPlaceholder ? (
      <div class="placeholder">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21 15 16 10 5 21"/>
        </svg>
        {label && <span class="placeholder-label">{label}</span>}
      </div>
    ) : (
      <img src={src} alt={alt} loading="lazy" style={imgStyle} />
    )}
  </div>
  {caption && <figcaption class="caption">{caption}</figcaption>}
</figure>

<style>
  .image-wrapper {
    margin: var(--space-12) 0;
  }

  .image-wrapper.no-margin {
    margin: 0;
  }

  .image-container {
    position: relative;
    width: 100%;
    border-radius: var(--radius-md);
    overflow: hidden;
  }

  .image-container img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-position: center;
  }

  .placeholder {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    background-color: var(--color-bg-tertiary);
    color: var(--color-text-tertiary);
  }

  .placeholder svg {
    opacity: 0.5;
  }

  .placeholder-label {
    font-size: var(--font-caption, var(--text-sm));
    color: var(--color-text-secondary);
    text-align: center;
    max-width: 80%;
  }

  .caption {
    margin-top: var(--space-3);
    font-size: var(--font-caption, var(--text-sm));
    color: var(--color-text-secondary);
    text-align: center;
    font-style: normal;
  }
</style>
